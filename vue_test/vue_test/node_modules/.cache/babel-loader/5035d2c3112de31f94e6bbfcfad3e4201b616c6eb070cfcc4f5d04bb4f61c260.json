{"ast":null,"code":"export default {\n  props: {\n    trigger: {\n      type: Date,\n      default: false\n    },\n    config: {\n      type: Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      isRunning: false,\n      currentDeg: 0,\n      targetDeg: 0,\n      giftsDeg: []\n    };\n  },\n  computed: {\n    displayType() {\n      return this.config.run3D ? 'three-dimension' : 'flat';\n    },\n    rotate() {\n      return 360 / this.config.gifts.length;\n    },\n    translateZ() {\n      return this.config.height / 2 / Math.tan(this.rotate / 2 / 180 * Math.PI);\n    }\n  },\n  watch: {\n    config: {\n      handler() {\n        this.setConfig();\n      },\n      deep: true\n    },\n    trigger() {\n      this.autoTurn();\n    },\n    isRunning() {\n      if (this.isRunning) {\n        setTimeout(() => {\n          this.autoTurnStop();\n        }, this.config.duration + 200);\n      }\n    }\n  },\n  mounted() {\n    this.setConfig();\n    this.logGiftsDeg();\n  },\n  methods: {\n    logGiftsDeg() {\n      // 紀錄獎品角度\n      this.config.gifts.forEach((gift, index) => {\n        this.giftsDeg[index] = {\n          from: index === 0 ? 0 : this.giftsDeg[index - 1].to,\n          to: index === 0 ? this.rotate : this.giftsDeg[index - 1].to + this.rotate,\n          name: gift.name\n        };\n      });\n    },\n    setConfig() {\n      // 將config的變數們寫入CSS變數中\n      this.$el.style.setProperty('--rotateY', `${this.config.rotateY}deg`);\n      this.$el.style.setProperty('--duration', `${this.config.duration}ms`);\n      this.$el.style.setProperty('--fontSize', `${this.config.fontSize}px`);\n      this.$el.style.setProperty('--height', `${this.config.height}px`);\n      this.$el.style.setProperty('--width', `${this.config.width}px`);\n      this.$el.style.setProperty('--currentDeg', `-${this.currentDeg}deg`);\n    },\n    autoTurn() {\n      // 取得隨機角度(預設至少跑5圈)\n      let randomDeg = Math.random() * 360 + 360 * 5;\n      randomDeg -= randomDeg % this.rotate; // 減去餘數，避免有高低不一的狀況\n      this.targetDeg = randomDeg;\n      // 取得隨機回彈角度\n      const randomRollBackDeg = this.config.rollback ? Math.random() * this.config.rollback + 1 : 1;\n      // 設定轉動角度\n      this.$el.style.setProperty('--targetDeg', `-${this.targetDeg}deg`);\n      this.$el.style.setProperty('--rollBackDeg', `${randomRollBackDeg}`);\n      // 執行轉動\n      this.isRunning = true;\n    },\n    autoTurnStop() {\n      // 把結束時的角度設定為當前角度\n      this.currentDeg = this.targetDeg % 360;\n      this.$el.style.setProperty('--currentDeg', `-${this.currentDeg}deg`);\n      // 顯示獎品資料(結束角度 + 單片角度/2)\n      let giftName = null;\n      const endDeg = this.currentDeg + this.rotate / 2;\n      this.giftsDeg.forEach(gift => {\n        if (endDeg >= gift.from && endDeg <= gift.to) {\n          giftName = gift.name;\n        }\n      });\n      // 宣告轉動結束\n      this.isRunning = false;\n      this.$emit('finished', giftName); // 告訴上層已經轉完\n    }\n  }\n};","map":{"version":3,"names":["props","trigger","type","Date","default","config","Object","required","data","isRunning","currentDeg","targetDeg","giftsDeg","computed","displayType","run3D","rotate","gifts","length","translateZ","height","Math","tan","PI","watch","handler","setConfig","deep","autoTurn","setTimeout","autoTurnStop","duration","mounted","logGiftsDeg","methods","forEach","gift","index","from","to","name","$el","style","setProperty","rotateY","fontSize","width","randomDeg","random","randomRollBackDeg","rollback","giftName","endDeg","$emit"],"sources":["/app/src/components/TextOptions.vue"],"sourcesContent":["<!-- <template>\n    <div class=\"textOption\">\n        <div :class=\"['option-view', displayType, {'autoTurn': isRunning}]\">\n            <div :class=\"['option', props.config.style]\" v-for=\"(option, index) in props.config.options\" :key=\"index\" :style=\"`transform: rotateX(${(rotate) * index}deg) translateZ(${translateZ}px)`\">\n                <template v-if=\"option.type === 'text'\">{{ option.name }}</template>\n                <template v-if=\"option.type === 'image'\">\n                    <img :src=\"option.path\" :height=\"config.height\">\n                </template>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, defineProps, defineEmits, computed, onMounted, watch } from 'vue';\nimport { prop } from 'vue-class-component';\nconst props = defineProps({\n    trigger: {\n        type: Date,\n        default: false\n    },\n    config: {\n        type: Object,\n        required: true,\n    },\n});\nconst emits = defineEmits(['finished']);\n\nconst isRunning = ref(false);\nvar currentDeg = 0;\nvar targetDeg = 0;\nvar optionsDeg = [];\nconst displayType = computed(() => {\n    return props.config.run3D ? 'three-dimension' : 'flat';\n})\n\nconst rotate = computed(() => {\n    return 360 / props.config.options.length;\n})\n\nconst translateZ = computed(() => {\n    return (props.config.height / 2) / Math.tan((this.rotate / 2 / 180) * Math.PI)\n})\n\nfunction logOptionDeg() {\n    //記錄獎品角度\n    props.config.options.array.forEach((option, index) => {\n        this.optionsDeg[index] = {\n            from: index === 0 ? 0 : this.optionsDeg[index - 1].to,\n            to: index === 0 ? this.rotate : this.optionsDeg[index - 1].to + this.rotate,\n            name: option.name\n        }\n    });\n}\n\nfunction setConfig() {\n    this.$el.style.setProperty('--rotateY', `${props.config.rotateY}deg`);\n    this.$el.style.setProperty('--duration', `${props.config.duration}ms`);\n    this.$el.style.setProperty('--fontSize', `${props.config.fontSize}px`);\n    this.$el.style.setProperty('--height', `${props.config.height}px`);\n    this.$el.style.setProperty('--width', `${props.config.width}px`);\n    this.$el.style.setProperty('--currentDeg', `${this.currentDeg}deg`);\n}\n\nfunction autoRun() {\n    //取得隨機角度\n    let randomDeg = (Math.random() * 360) + (360 * 5);\n    randomDeg -= randomDeg % this.rotate;\n    this.targetDeg = randomDeg;\n\n    //取得隨機迴轉角度\n    const randomRollBackeg = props.config.rollback ? Math.random() * props.config.rollback + 1 : 1\n\n    //設定轉動角度\n    this.$el.style.setProperty('--targetDeg', `${this.targetDeg}deg`);\n    this.$el.style.setProperty('--rollBackDeg', `${randomRollBackeg}`);\n\n    //執行轉動\n    this.isRunning.value = true\n}\n\nfunction autoRunStop() {\n    //把結束時的角度設定為當前的角度\n    this.currentDeg = this.targetDeg % 360;\n    this.$el.style.setProperty('--currentDeg', `${this.currentDeg}deg`);\n\n    //顯示獎品資料(結束角度 + 單片角度/2)\n    let optionName = null\n    const endDeg = this.currentDeg + (this.rotate / 2);\n    this.optionsDeg.array.forEach(option => {\n        if (endDeg >= option.from && endDeg <= option.to) {\n            optionName = option.name\n        }\n    });\n    //宣告轉動結束\n    this.isRunning.value = false\n    this.emits('finished', optionName)\n}\n\nonMounted(() => {\n    setConfig();\n    logOptionDeg();\n})\n\nwatch(() => props.config, () => {setConfig()}, {deep: true});\nwatch(() => props.trigger, () => {autoRun()}, {deep: true});\nwatch(() => isRunning, (newValue) => {\n    if (isRunning.value) {\n        setTimeout(() => {\n            autoRunStop()\n        }, props.config.duration + 200)\n    }\n}, {deep: true})\n\n</script>\n\n<style scope>\n</style> -->\n\n<template>\n    <div :class=\"['gift-container', displayType, { 'autoTurn': isRunning }]\">\n      <div\n        :class=\"['gift', config.style]\"\n        v-for=\"(gift, index) in config.gifts\"\n        :key=\"index\"\n        :style=\"`transform: rotateX(${(rotate) * index}deg) translateZ(${translateZ}px)`\">\n        <template v-if=\"gift.type === 'text'\">{{ gift.name }}</template>\n        <template v-if=\"gift.type === 'image'\">\n          <img :src=\"gift.path\" :height=\"config.height\">\n        </template>\n      </div>\n    </div>\n  </template>\n  \n  <script>\n  export default {\n    props: {\n      trigger: {\n        type: Date,\n        default: false\n      },\n      config: {\n        type: Object,\n        required: true\n      }\n    },\n    data () {\n      return {\n        isRunning: false,\n        currentDeg: 0,\n        targetDeg: 0,\n        giftsDeg: []\n      }\n    },\n    computed: {\n      displayType () {\n        return this.config.run3D ? 'three-dimension' : 'flat'\n      },\n      rotate () {\n        return 360 / this.config.gifts.length\n      },\n      translateZ () {\n        return (this.config.height / 2) / Math.tan((this.rotate / 2 / 180) * Math.PI)\n      }\n    },\n    watch: {\n      config: {\n        handler () {\n          this.setConfig()\n        },\n        deep: true\n      },\n      trigger () {\n        this.autoTurn()\n      },\n      isRunning () {\n        if (this.isRunning) {\n          setTimeout(() => {\n            this.autoTurnStop()\n          }, this.config.duration + 200)\n        }\n      }\n    },\n    mounted () {\n      this.setConfig()\n      this.logGiftsDeg()\n    },\n    methods: {\n      logGiftsDeg () {\n        // 紀錄獎品角度\n        this.config.gifts.forEach((gift, index) => {\n          this.giftsDeg[index] = {\n            from: index === 0 ? 0 : this.giftsDeg[index - 1].to,\n            to: index === 0 ? this.rotate : this.giftsDeg[index - 1].to + this.rotate,\n            name: gift.name\n          }\n        })\n      },\n      setConfig () {\n        // 將config的變數們寫入CSS變數中\n        this.$el.style.setProperty('--rotateY', `${this.config.rotateY}deg`)\n        this.$el.style.setProperty('--duration', `${this.config.duration}ms`)\n        this.$el.style.setProperty('--fontSize', `${this.config.fontSize}px`)\n        this.$el.style.setProperty('--height', `${this.config.height}px`)\n        this.$el.style.setProperty('--width', `${this.config.width}px`)\n        this.$el.style.setProperty('--currentDeg', `-${this.currentDeg}deg`)\n      },\n      autoTurn () {\n        // 取得隨機角度(預設至少跑5圈)\n        let randomDeg = (Math.random() * 360) + (360 * 5)\n        randomDeg -= randomDeg % this.rotate // 減去餘數，避免有高低不一的狀況\n        this.targetDeg = randomDeg\n        // 取得隨機回彈角度\n        const randomRollBackDeg = this.config.rollback\n          ? Math.random() * this.config.rollback + 1\n          : 1\n        // 設定轉動角度\n        this.$el.style.setProperty('--targetDeg', `-${this.targetDeg}deg`)\n        this.$el.style.setProperty('--rollBackDeg', `${randomRollBackDeg}`)\n        // 執行轉動\n        this.isRunning = true\n      },\n      autoTurnStop () {\n        // 把結束時的角度設定為當前角度\n        this.currentDeg = this.targetDeg % 360\n        this.$el.style.setProperty('--currentDeg', `-${this.currentDeg}deg`)\n        // 顯示獎品資料(結束角度 + 單片角度/2)\n        let giftName = null\n        const endDeg = this.currentDeg + (this.rotate / 2)\n        this.giftsDeg.forEach((gift) => {\n          if (endDeg >= gift.from && endDeg <= gift.to) {\n            giftName = gift.name\n          }\n        })\n        // 宣告轉動結束\n        this.isRunning = false\n        this.$emit('finished', giftName) // 告訴上層已經轉完\n      }\n    }\n  }\n  </script>\n  \n  <style lang=\"scss\">\n  .gift-container {\n    /* 變數區 START */\n    $width: var(--width);\n    $height: var(--height);\n    $fontSize: var(--fontSize);\n    //\n    $duration: var(--duration);\n    $rotateY: var(--rotateY);\n    $targetDeg: var(--targetDeg);\n    $currentDeg: var(--currentDeg);\n    $rollBackDeg: var(--rollBackDeg);\n    /* 變數區 END*/\n    * {\n      box-sizing: border-box;\n    }\n    perspective: 999999px;\n    user-select: none;\n    position: relative;\n    display: flex;\n    align-items: center;\n    margin-right: $width;\n    transform-style: preserve-3d;\n    .gift {\n      position: absolute;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: $width;\n      height: $height;\n      border: 1px solid #333;\n      background-color: #fff;\n      font-size: $fontSize;\n      img {\n        padding: 1px;\n      }\n    }\n  \n    &.flat {\n      transform: rotateX($currentDeg);\n      &.autoTurn {\n        transition: $duration ease-in-out;\n        transform: rotateX($targetDeg);\n      }\n    }\n  \n    &.three-dimension {\n      transform: rotateY($rotateY) rotateX($currentDeg);\n      &.autoTurn {\n        transition: $duration cubic-bezier(0.1, 0, 0, $rollBackDeg);\n        transform: rotateY($rotateY) rotateX($targetDeg);\n      }\n    }\n  }\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}